<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Payroll</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 20px; }
    .wrap { max-width: 1100px; margin: 0 auto; }
    .topbar { display:flex; gap: 12px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 14px; margin-top: 14px; }
    .muted { color: #666; }
    .btn {
      display:inline-block; padding: 10px 12px; border-radius: 8px;
      border: 1px solid #222; text-decoration: none; color: #111; background: #fff;
      cursor: pointer;
    }
    .btn.primary { background: #111; color: #fff; }
    .formrow { display:flex; gap: 10px; align-items: end; flex-wrap: wrap; }
    label { display:block; font-size: 12px; margin-bottom: 6px; }
    input[type="date"] { padding: 8px; border: 1px solid #ccc; border-radius: 8px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { text-align: left; padding: 8px 10px; border-bottom: 1px solid #eee; vertical-align: top; }
    th { background: #fafafa; font-size: 13px; }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    @media (max-width: 900px) { .grid2 { grid-template-columns: 1fr; } }
    .pill { display:inline-block; padding: 2px 8px; border-radius: 999px; background:#f2f2f2; font-size: 12px; }
    .right { text-align:right; }
    details summary { cursor: pointer; }
  </style>
</head>

<body>
<div class="wrap">
  <div class="topbar">
    <div>
      <h2 style="margin:0;">Payroll</h2>
      <div class="muted">Clock-outs between <strong>{{ start }}</strong> and <strong>{{ end }}</strong></div>
    </div>

    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <a class="btn" href="{{ url_for('admin_dashboard') }}">Back to Dashboard</a>
      <a class="btn primary" href="{{ url_for('admin_payroll', start=start, end=end, format='csv') }}">Export CSV</a>
    </div>
  </div>

  <div class="card">
    <form method="get" action="{{ url_for('admin_payroll') }}">
      <div class="formrow">
        <div>
          <label for="start">Start</label>
          <input id="start" name="start" type="date" value="{{ start }}">
        </div>
        <div>
          <label for="end">End</label>
          <input id="end" name="end" type="date" value="{{ end }}">
        </div>
        <div>
          <button class="btn primary" type="submit">View</button>
        </div>
        <div class="muted" style="padding-bottom:2px;">
          Defaults to last completed Monâ€“Sun when blank.
        </div>
      </div>
    </form>
  </div>

  <div class="grid2">
    <div class="card">
      <h3 style="margin-top:0;">Employee totals</h3>
      <table>
        <thead>
          <tr>
            <th>Employee</th>
            <th class="right">Total</th>
            <th class="right">Regular</th>
            <th class="right">OT</th>
          </tr>
        </thead>
        <tbody>
          {% for emp in emp_summary %}
          <tr>
            <td>
              <div><strong>{{ emp.employee }}</strong></div>
              <div class="muted" style="margin-top:4px;">
                <details>
                  <summary>Store breakdown</summary>
                  <div style="margin-top:8px;">
                    {% if emp.stores and emp.stores|length > 0 %}
                      <table>
                        <thead>
                          <tr>
                            <th>Store</th>
                            <th class="right">Hours</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for st in emp.stores %}
                          <tr>
                            <td>{{ st.store }}</td>
                            <td class="right">{{ st.hours }}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    {% else %}
                      <div class="muted">No store detail.</div>
                    {% endif %}
                  </div>
                </details>
              </div>
            </td>
            <td class="right">{{ emp.hours }}</td>
            <td class="right">{{ emp.regular_hours }}</td>
            <td class="right">
              {% if emp.overtime_hours and emp.overtime_hours > 0 %}
                <span class="pill">{{ emp.overtime_hours }}</span>
              {% else %}
                0.00
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th>Grand total</th>
            <th class="right">{{ grand_total }}</th>
            <th></th>
            <th></th>
          </tr>
        </tfoot>
      </table>
    </div>

    <div class="card">
      <h3 style="margin-top:0;">Store totals</h3>
      <table>
        <thead>
          <tr>
            <th>Store</th>
            <th class="right">Hours</th>
          </tr>
        </thead>
        <tbody>
          {% for st in store_summary %}
          <tr>
            <td><strong>{{ st.store }}</strong></td>
            <td class="right">{{ st.hours }}</td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th>Grand total</th>
            <th class="right">{{ grand_total }}</th>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <div class="card">
    <h3 style="margin-top:0;">Detail</h3>
    <div class="muted" style="margin-bottom:10px;">
      Each row is a shift that clocked out within the selected payroll week.
    </div>
    <table>
      <thead>
        <tr>
          <th>Employee</th>
          <th>Store</th>
          <th>Clock In</th>
          <th>Clock Out</th>
          <th class="right">Hours</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r.employee }}</td>
          <td>{{ r.store }}</td>
          <td>{{ r.clock_in }}</td>
          <td>{{ r.clock_out }}</td>
          <td class="right">{{ r.hours }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% if rows|length == 0 %}
      <div class="muted" style="margin-top:10px;">No shifts found for this date range.</div>
    {% endif %}
  </div>
</div>
</body>
</html>
