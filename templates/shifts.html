{% extends "base.html" %}
{% block title %}Shifts{% endblock %}

{% block content %}
  <div class="card">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <div>
        <div style="font-size:28px; font-weight:800;">Shifts</div>
        <div style="color:#6b7280; margin-top:6px;">Recent shifts (open first, then newest).</div>
      </div>
      <div style="display:flex; gap:10px; align-items:center;">
        <a class="btn btn-primary" href="{{ url_for('admin_shift_new') }}">Add Shift</a>
        <a class="btn" href="{{ url_for('admin_audit') }}">Audit Log</a>
      </div>
    </div>
  </div>

  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Status</th>
          <th>Employee</th>
          <th>Store</th>
          <th>Clock In</th>
          <th>Clock Out</th>
          <th>Worked</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for s in shifts %}
          <tr>
            <td>
              {% if s.clock_out %}
                <span style="color:#6b7280; font-weight:700;">Closed</span>
              {% else %}
                <span style="color:#16a34a; font-weight:700;">Open</span>
              {% endif %}
            </td>
            <td>{{ s.employee.name }}</td>
            <td>{{ s.store.name }}</td>
            <td>{{ fmt_dt(s.clock_in) }}</td>
            <td>{{ fmt_dt(s.clock_out) }}</td>
            <td>
              {% if s.clock_out %}
                {{ minutes_to_human(shift_minutes(s)) }}
              {% else %}
                â€”
              {% endif %}
            </td>
            <td style="white-space:nowrap; text-align:right;">
              <!-- View pings filtered to this shift -->
              <a class="btn" href="{{ url_for('admin_pings', shift_id=s.id) }}">View GPS</a>

              <a class="btn btn-primary" href="{{ url_for('admin_shift_edit', shift_id=s.id) }}">Edit</a>

              {% if not s.clock_out %}
                <form method="post" action="{{ url_for('admin_close_shift') }}" style="display:inline; margin:0;">
                  <input type="hidden" name="shift_id" value="{{ s.id }}">
                  <button class="btn" type="submit">Close</button>
                </form>
              {% endif %}
            </td>
          </tr>
        {% endfor %}

        {% if shifts|length == 0 %}
          <tr>
            <td colspan="7" style="padding:16px; color:#6b7280;">No shifts found.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
{% endblock %}
